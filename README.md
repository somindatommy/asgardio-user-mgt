# asgardio-user-mgt
This contains the components related to the asgardio user management

## Asgardio User Tenant Association Manager
Service to be used for managing associations between the user and the tenant.

## Asgardio User Store Manager
### Schema
```
REATE TABLE ASG_USER_TENANT_ASC (
	ASG_ID INTEGER NOT NULL AUTO_INCREMENT,
	ASG_USER_UUID VARCHAR(255) NOT NULL,
	ASG_TENANT_UUID VARCHAR(255) NOT NULL,
	ASG_ASSOCIATION VARCHAR(255) NOT NULL,
	UNIQUE (ASG_ID, ASG_USER_UUID),
	CONSTRAINT UNIQUE_ASSOCIATION UNIQUE (ASG_USER_UUID, ASG_TENANT_UUID),
	CONSTRAINT FK_USER_UUID FOREIGN KEY (ASG_USER_UUID) REFERENCES UM_USER(UM_USER_ID) ON DELETE CASCADE,
	CONSTRAINT PK_ASG_USER_TENANT_ASC PRIMARY KEY (ASG_ID)
)ENGINE INNODB;

CREATE INDEX IDX_ASC_BY_USER_UUID ON ASG_USER_TENANT_ASC (ASG_USER_UUID);

CREATE INDEX IDX_ASC_BY_TENANT_UUID ON ASG_USER_TENANT_ASC (ASG_TENANT_UUID);
```
### Prerequisites

#### Removing the constraints from the default schema.

**NOTE:** Check the constraints in the following tables. Only need to remove the constraints with the `UM_USER` table
which as the `UM_TENANT_ID`.

```
ALTER TABLE UM_USER_ROLE DROP FOREIGN KEY UM_USER_ROLE_ibfk_2;

ALTER TABLE UM_USER_ROLE
ADD CONSTRAINT FK_UM_USER_ROLE_USER_ID
FOREIGN KEY (UM_USER_ID) REFERENCES UM_USER(UM_ID);

ALTER TABLE UM_SHARED_USER_ROLE DROP FOREIGN KEY UM_SHARED_USER_ROLE_ibfk_2;

ALTER TABLE UM_SHARED_USER_ROLE
ADD CONSTRAINT FK_UM_SHARED_USER_ROLE_UM_USER_ID
FOREIGN KEY (UM_USER_ID) REFERENCES UM_USER(UM_ID);

ALTER TABLE UM_USER_ATTRIBUTE DROP FOREIGN KEY UM_USER_ATTRIBUTE_ibfk_1;

ALTER TABLE UM_USER_ATTRIBUTE
ADD CONSTRAINT FK_UM_USER_ATTRIBUTE_UM_USER_ID
FOREIGN KEY (UM_USER_ID) REFERENCES UM_USER(UM_ID);
```
